<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FOUR CHARIOTS</title>
  <meta name="description" content="Built to last. Made for daily discipline." />

  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='15' fill='%230b1a2a'/><text x='16' y='22' text-anchor='middle' font-size='18' font-weight='900' font-family='system-ui,sans-serif' fill='%23ffffff'>4C</text></svg>" />
  <link rel="icon" type="image/png" sizes="192x192" href="images/logo.png" />
  <link rel="apple-touch-icon" href="images/logo.png" />

  <meta property="og:title" content="FOUR CHARIOTS" />
  <meta property="og:description" content="Built to last. Made for daily discipline." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg:#ffffff;
      --text:#0a0a0a;
      --muted:#5f6368;
      --line:#e6e6e6;
      --soft:#f6f6f6;
      --ink:#0b1a2a;
      --btn:var(--ink);
      --btnText:#ffffff;
      --btnHover:#142a43;
      --max:1200px;
      --radius:0px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:var(--bg);
      line-height:1.35;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a{ color:inherit; text-decoration:none; }
    img{ max-width:100%; display:block; }
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding: 18px 18px 70px;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding: 14px 0;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-transform:uppercase;
      letter-spacing:-0.02em;
      font-weight:900;
    }
    .brand .wordmark{
      display:flex;
      flex-direction:column;
      line-height:1;
    }
    .brand .name{
      font-size:14px;
      letter-spacing:0.10em;
    }
    .brand .tag{
      margin-top:4px;
      font-size:11px;
      letter-spacing:0.14em;
      color:var(--muted);
      font-weight:700;
    }
    .mark{
      height:100px;
      width:auto;
      display:block;
    }
    .nav{
      display:flex;
      gap:18px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .nav a{
      padding:8px 0;
      border-bottom:2px solid transparent;
    }
    .nav a:hover{
      color:var(--text);
      border-bottom-color:var(--text);
    }
    .ctaRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 16px;
      font-size:13px;
      font-weight:800;
      letter-spacing:0.06em;
      text-transform:uppercase;
      border:1px solid var(--text);
      border-radius:var(--radius);
      background:transparent;
      color:var(--text);
      transition: background .12s ease, color .12s ease, border-color .12s ease;
      white-space:nowrap;
      cursor:pointer;
    }
    .btn:hover{
      background:var(--text);
      color:var(--btnText);
    }
    .btn.primary{
      background:var(--btn);
      color:var(--btnText);
      border-color:var(--btn);
    }
    .btn.primary:hover{
      background:var(--btnHover);
      border-color:var(--btnHover);
    }
    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .divider{ border-top:1px solid var(--line); }

    .hero{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 26px;
      padding: 34px 0 26px;
      align-items:end;
    }
    .kicker{
      font-size:12px;
      letter-spacing:0.18em;
      text-transform:uppercase;
      color:var(--muted);
      margin:0 0 10px;
    }
    .headline{
      margin:0;
      font-size: clamp(34px, 4.2vw, 56px);
      line-height:0.98;
      letter-spacing:-0.04em;
      text-transform:uppercase;
      font-weight:950;
      color:var(--ink);
    }
    .subhead{
      margin:14px 0 0;
      font-size:16px;
      max-width:62ch;
      color:var(--muted);
    }
    .heroCard{
      border:1px solid var(--line);
      padding: 18px;
      background: var(--soft);
    }
    .heroCard .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 10px 0;
      border-top:1px solid var(--line);
      font-size:13px;
    }
    .heroCard .row:first-child{ border-top:none; padding-top:0; }
    .heroCard .label{ color:var(--muted); }
    .heroCard .value{
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.06em;
      color:var(--ink);
      text-align:right;
    }
    .heroCard .note{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }

    .sectionTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:14px;
      padding: 18px 0 10px;
    }
    .sectionTitle h2{
      margin:0;
      font-size:18px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      font-weight:950;
      color:var(--ink);
    }
    .sectionTitle p{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 18px;
      padding-top: 12px;
    }
    .product{
      grid-column: span 6;
      border:1px solid var(--line);
      background: var(--bg);
      display:flex;
      flex-direction:column;
      min-height: 520px;
    }
    .product .media{
      aspect-ratio: 4/3;
      background: #fafafa;
      border-bottom:1px solid var(--line);
      overflow:hidden;
    }
    .product .media img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .product .body{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 170px;
    }
    .product .name{
      margin:0;
      font-weight:950;
      text-transform:uppercase;
      letter-spacing:-0.02em;
      font-size:16px;
      line-height:1.05;
      color:var(--ink);
    }
    .product .desc{
      margin:0;
      color:var(--muted);
      font-size:13px;
      max-width:62ch;
    }
    .product .meta{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.10em;
      margin-top:2px;
    }
    .product .bottom{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-top:1px solid var(--line);
      padding: 14px 16px;
    }
    .price{
      font-weight:950;
      letter-spacing:-0.02em;
      color:var(--ink);
    }
    .fine{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:8px;
    }
    select, input[type="number"]{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 10px;
      border-radius:0;
      font:inherit;
      font-size:13px;
      min-width: 170px;
    }
    input[type="number"]{ width: 90px; min-width: 90px; }

    footer{
      margin-top: 34px;
      padding-top: 18px;
      border-top:1px solid var(--line);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      color:var(--muted);
      font-size:13px;
    }
    footer .links{ display:flex; gap:14px; flex-wrap:wrap; }
    footer .links a:hover{ color:var(--text); }

    .status{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }
    .status.error{ color:#b00020; }
    .status.ok{ color:#0b6b2f; }

    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; align-items:start; }
      .product{ grid-column: span 12; }
      .nav{ display:none; }
      .brand .tag{ display:none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <a class="brand" href="#">
        <img class="mark" src="images/logo.png" alt="Four Chariots logo" />
        <span class="wordmark">
          <span class="name">FOUR CHARIOTS</span>
          <span class="tag">BUILT TO LAST</span>
        </span>
      </a>

      <nav class="nav" aria-label="Site navigation">
        <a href="#shop">Shop</a>
        <a href="#shipping">Shipping</a>
        <a href="#support">Support</a>
      </nav>

      <div class="ctaRow">
        <a class="btn" href="#shop">Shop</a>
        <a class="btn primary" href="#shop">Checkout</a>
      </div>
    </div>

    <div class="divider"></div>

    <section class="hero">
      <div>
        <p class="kicker">APPAREL • PRINTS • DAILY OBJECTS</p>
        <h1 class="headline">DISCIPLINE, WITHOUT NOISE.</h1>
        <p class="subhead">
          FOUR CHARIOTS makes clean pieces for daily life. Wear it. See it. Hold it. Simple words that keep you steady.
        </p>
        <p class="status" id="status"></p>
      </div>

      <aside class="heroCard" id="shipping">
        <div class="row">
          <span class="label">Standard</span>
          <span class="value">Built to last</span>
        </div>
        <div class="row">
          <span class="label">Focus</span>
          <span class="value">Order & restraint</span>
        </div>
        <div class="row">
          <span class="label">Fulfillment</span>
          <span class="value">Printed to order</span>
        </div>
        <div class="row">
          <span class="label">Shipping</span>
          <span class="value">Shown at checkout</span>
        </div>
        <div style="margin-top:14px;">
          <a class="btn primary" href="#shop">Shop the drop</a>
        </div>
        <p class="note">
          Orders are paid on Stripe and fulfilled by Printify.
        </p>
      </aside>
    </section>

    <div class="divider"></div>

    <div class="sectionTitle" id="shop">
      <h2>The Drop</h2>
      <p>Wear it. See it. Hold it.</p>
    </div>

    <section class="grid" id="grid" aria-label="Products"></section>

    <footer id="support">
      <div>© <span id="year"></span> FOUR CHARIOTS</div>
      <div class="links">
        <a href="mailto:you@example.com">Contact</a>
        <a href="YOUR_INSTAGRAM_URL_HERE" target="_blank" rel="noopener">Instagram</a>
      </div>
    </footer>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ---------------------------
    // REQUIRED: replace these
    // ---------------------------
    const SUPABASE_URL  = "https://txeemijqgqomfclezonf.supabase.co";

    // Use the REAL anon key from Supabase Project Settings -> API (starts with eyJ...)
    const SUPABASE_ANON = "PASTE_YOUR_SUPABASE_ANON_KEY_HERE";

    // Edge function routes
    const PRINTIFY_PRODUCTS_FN = `${SUPABASE_URL}/functions/v1/printify`;
    const CREATE_CHECKOUT_FN   = `${SUPABASE_URL}/functions/v1/create_checkout`;

    // IMPORTANT:
    // Stripe needs a price per product. Map Printify product id -> Stripe price id.
    // You can find Printify product id in the products payload returned by your function.
    // Example: "26772248": "price_123..."
    const PRICE_MAP = {
      // "PRINTIFY_PRODUCT_ID": "price_..."
      // "26772248": "price_1SzeEnL7gUbRzdPiJ7s7CWtJ"
    };

    function setStatus(msg, kind) {
      const el = document.getElementById("status");
      el.textContent = msg || "";
      el.className = "status" + (kind ? (" " + kind) : "");
    }

    function money(cents) {
      const n = Number(cents || 0) / 100;
      return "$" + n.toFixed(2);
    }

    async function apiGet(url) {
      const res = await fetch(url, {
        headers: {
          "Authorization": `Bearer ${SUPABASE_ANON}`,
          "apikey": SUPABASE_ANON
        }
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data?.error || `HTTP ${res.status}`);
      return data;
    }

    async function apiPost(url, body) {
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${SUPABASE_ANON}`,
          "apikey": SUPABASE_ANON
        },
        body: JSON.stringify(body)
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data?.error || data?.message || `HTTP ${res.status}`);
      return data;
    }

    function buildCard(p) {
      const img = (p.images && p.images[0]) ? p.images[0] : "";
      const enabled = (p.variants || []).filter(v => v.is_enabled && v.is_available);

      const lowest = enabled.length ? Math.min(...enabled.map(v => Number(v.price || 0))) : 0;

      const stripePriceId = PRICE_MAP[String(p.id)] || "";

      const card = document.createElement("article");
      card.className = "product";

      card.innerHTML = `
        <div class="media">
          <img src="${img}" alt="${(p.title || "Product")} mockup" loading="lazy" />
        </div>

        <div class="body">
          <h3 class="name">${p.title || "Untitled product"}</h3>
          <p class="desc">${p.description || ""}</p>

          <div class="meta">
            ${(p.tags || []).slice(0, 3).map(t => `<span>${t}</span>`).join("")}
          </div>

          <div class="controls">
            <label>
              <select class="variantSelect">
                ${enabled.map(v => `<option value="${v.id}" data-price="${v.price}">${v.title}</option>`).join("")}
              </select>
            </label>

            <label>
              <input class="qty" type="number" min="1" max="10" value="1" />
            </label>
          </div>

          <div class="status" style="margin-top:6px;">
            ${stripePriceId ? "" : "Add Stripe price_id in PRICE_MAP for this product id: " + p.id}
          </div>
        </div>

        <div class="bottom">
          <div>
            <div class="price">${enabled.length ? ("From " + money(lowest)) : "Unavailable"}</div>
            <div class="fine">Shipping shown at Stripe checkout</div>
          </div>
          <button class="btn primary buyBtn" ${(!enabled.length || !stripePriceId) ? "disabled" : ""}>
            Buy
          </button>
        </div>
      `;

      const select = card.querySelector(".variantSelect");
      const qtyInput = card.querySelector(".qty");
      const buyBtn = card.querySelector(".buyBtn");

      buyBtn.addEventListener("click", async () => {
        const variantId = Number(select.value);
        const quantity = Math.max(1, Math.min(10, Number(qtyInput.value || 1)));

        buyBtn.disabled = true;
        const prev = buyBtn.textContent;
        buyBtn.textContent = "Loading...";

        try {
          // NOTE:
          // This assumes your create_checkout function accepts:
          // { variant_id, quantity, stripe_price_id }
          const out = await apiPost(CREATE_CHECKOUT_FN, {
            variant_id: variantId,
            quantity,
            stripe_price_id: stripePriceId
          });

          if (!out.url) throw new Error("No checkout URL returned");
          window.location.href = out.url;
        } catch (e) {
          console.error(e);
          alert("Checkout failed. Open console for details.");
          buyBtn.disabled = false;
          buyBtn.textContent = prev;
        }
      });

      return card;
    }

    async function loadProducts() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      setStatus("Loading products...", "");

      try {
        const data = await apiGet(PRINTIFY_PRODUCTS_FN);
        const products = data.products || [];

        if (!products.length) {
          setStatus("No products returned yet.", "error");
          return;
        }

        products.forEach(p => grid.appendChild(buildCard(p)));
        setStatus("Products loaded.", "ok");
      } catch (e) {
        console.error(e);
        setStatus("Could not load products. Check your Supabase anon key and function.", "error");
      }
    }

    loadProducts();
  </script>
</body>
</html>
